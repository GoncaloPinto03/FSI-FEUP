# CTF WEEK 11 - RSA

After running `nc ctf-fsi.fe.up.pt 6004` we received:
```
Public parameters --
e:  65537
n:  359538626972463181545861038157804946723595395788461314546860162315465351611001926265416954644815072042240227759742786715317579537628833244985694861278981701236320993629494407744974962788580249256628543925647431823478387165939959262654946897455580898378787650855347879176774607814575239301687064613518628850759
ciphertext: 3733623536336533393036336139353363316537633839353432643366386639363131383362316137383037363965333138646335613561346639303635313030353930323932333039613562653063343861363733306462366362346337333661373336643431373665393437313335313339383638623062663732373964633134613836306135633031666430306561343463633262613730613363383435303562626563363866386162643162306165373965633738323036366232313965633764326437393036643232303638343334653166346539663763323439666165333436623132663463386637616439626638383930616233643266663530303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030
```

We know that p is a prime close to 2^512 and q is a prime close to 2^513 and that p * q = n.

Knowing this we developed a program that calculates p and q given a n:

```python
from binascii import hexlify, unhexlify
from sympy import *

aux_p = 2**512
aux_q = 2**513

p = aux_p
q = aux_q

n = 359538626972463181545861038157804946723595395788461314546860162315465351611001926265416954644815072042240227759742786715317579537628833244985694861278981701236320993629494407744974962788580249256628543925647431823478387165939959262654946897455580898378787650855347879176774607814575239301687064613518628850759

while(p * q != n):
    q = nextprime(q)
    if(p * q > n):
        aux_p = nextprime(aux_p)
        p = aux_p
        q = aux_q

print("p =", p)
print("q =", q)
```

After running the program we got the values of `p` and `q`:

```python
p = 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084823
q = 26815615859885194199148049996411692254958731641184786755447122887443528060147093953603748596333806855380063716372972101707507765623893139892867298012169233
```

Then we just changed the fiven challenge.py file to get the flag:

```python
from binascii import hexlify, unhexlify
from sympy import *

p = 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084823
q = 26815615859885194199148049996411692254958731641184786755447122887443528060147093953603748596333806855380063716372972101707507765623893139892867298012169233
n = p*q
e = 65537
d = pow(e,-1,((p-1)*(q-1)))

ciphertext = '3733623536336533393036336139353363316537633839353432643366386639363131383362316137383037363965333138646335613561346639303635313030353930323932333039613562653063343861363733306462366362346337333661373336643431373665393437313335313339383638623062663732373964633134613836306135633031666430306561343463633262613730613363383435303562626563363866386162643162306165373965633738323036366232313965633764326437393036643232303638343334653166346539663763323439666165333436623132663463386637616439626638383930616233643266663530303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030'

def enc(x, e, n):
    int_x = int.from_bytes(x, "little")
    y = pow(int_x,e,n)
    return hexlify(y.to_bytes(256, 'little'))

def dec(y, d, n):
    int_y = int.from_bytes(unhexlify(y), "little")
    x = pow(int_y,d,n)
    return x.to_bytes(256, 'little')

print(dec(unhexlify(ciphertext), d, n).decode())
```

After running the program we got the flag:

`flag{301f9caedd8ffe81f4c3536d61c36902}`